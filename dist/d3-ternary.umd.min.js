// https://github.com/davenquinn/d3-ternary#readme v2.0.2 Copyright 2021 Jules Blom
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-scale"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-array"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).d3=e.d3||{},e.d3,e.d3)}(this,(function(e,n,t){"use strict";const{cos:r,sin:i,atan:c,sign:a}=Math,l=e=>new Set(e.map((e=>{const n=Math.round(100*(e[0]+Number.EPSILON))/100,t=Math.round(100*(e[1]+Number.EPSILON))/100;return Math.abs(t-n)}))),o=(e,n)=>{if(0===e)return[0,-n];return d(-1/e,n)},s=([e,n],[t,r])=>i=>[e+i*(t-e),n+i*(r-n)],u=([e,n],[t,r])=>(r-n)/(t-e),f=e=>e>.999999?1:e<1e-6?0:e,g=(e,n,t)=>(n-e)*Math.sign(e)/Math.sqrt(Math.pow(t,2)+1),d=(e,n)=>{const t=c(e);return[n*r(t)*a(t),n*i(t)*a(t)]};function b(){const{sin:e,cos:n,PI:r}=Math,i=r/180;let c=e=>e[0],a=e=>e[1],l=e=>e[2];let[o,s,u]=[-90,150,30].map((t=>[n(t*i),e(t*i)]));function f(e){const n=[c(e),a(e),l(e)],r=t.sum(n);return 0===r?[0,0,0]:n.map((e=>e/r))}const g=function(e){const[n,t,r]=f(e);return[o[0]*n+s[0]*t+u[0]*r,o[1]*n+s[1]*t+u[1]*r]};return g.invert=function([e,n]){const[t,r]=o,[i,c]=s,[a,l]=u,f=c-l,g=a-i,d=t-a,b=l-r,m=e-a,k=n-l,A=f*d+g*(r-l),h=Math.abs((f*m+g*k)/A),p=Math.abs((b*m+d*k)/A);return[h,p,Math.abs(1-h-p)]},g.a=function(e){return e?(c=e,g):c},g.b=function(e){return e?(a=e,g):a},g.c=function(e){return e?(l=e,g):l},g.normalize=f,g.vertices=function(e){return e?(o=e[0],s=e[1],u=e[2],g):[o,s,u]},g}b(),e.barycentric=b,e.ternaryPlot=function(e){let t=500,r=1,i=0,c=0,a="%",d=!1,b=e.vertices();function m(n){const[r,i]=e(n);return[r*t,i*t]}function k(n){if(n){const r=n.map((([e,n])=>[e/t,n/t]));return e.vertices(r),m}return e.vertices().map((([e,n])=>[e*t,n*t]))}let[A,h,p]=k(),L={label:"A",labelAngle:0,labelOffset:45,gridLine:s(p,A),scale:n.scaleLinear().domain([0,1]),tickAngle:0,tickSize:6,tickTextAnchor:"start",conjugate:null},S={label:"B",labelAngle:60,labelOffset:45,gridLine:s(A,h),scale:n.scaleLinear().domain([0,1]),tickAngle:60,tickSize:6,tickTextAnchor:"end",conjugate:null},v={label:"C",labelAngle:-60,labelOffset:45,gridLine:s(h,p),scale:n.scaleLinear().domain([0,1]),tickAngle:-60,tickSize:6,tickTextAnchor:"end",conjugate:null};return L.conjugate=S,S.conjugate=v,v.conjugate=L,m.vertices=k,m.axisLabels=function({center:e=!1}={}){return[L,S,v].map((n=>{const{label:r,labelAngle:i}=n,[c,a]=n.gridLine(e?.5:1);return{position:[c/t*(t+n.labelOffset),a/t*(t+n.labelOffset)],label:r,angle:i}}))},m.setDomains=function(e){const[n,t,r]=e;return L.scale.domain(n),S.scale.domain(t),v.scale.domain(r),m},m.reverseVertices=function(){d=!0;const e=[p,A,h],[n,t,r]=b;return b=[r,n,t],m.vertices(e),L.gridLine=s(A,p),S.gridLine=s(h,A),v.gridLine=s(p,h),m},m.domains=function(e){if(!arguments.length)return[L.scale.domain(),S.scale.domain(),v.scale.domain()];const n=l(e);if(1!==n.size)throw new Error("Domains must all be of equal length");const t=e.every((e=>e[0]>e[1]));t?m.reverseVertices():d=!1,m.setDomains(e);const{x:r,y:i,k:c}=m.transformFromDomains(e);return m.translate([r,i]),m.scale(c),m},m.gridLines=function(e=20){return[L,S,v].map(((n,t)=>{const r=Array.isArray(e)?+e[t]:+e;return n.scale.ticks(r-1).map((e=>{var t;return[n.gridLine(n.scale(e)),null===(t=n.conjugate)||void 0===t?void 0:t.gridLine(1-n.scale(e))]}))}))},m.ticks=function(e=10){return[L,S,v].map(((n,t)=>{const r=Array.isArray(e)?+e[t]:+e,i=n.scale.ticks(r),c="function"==typeof a?a:n.scale.tickFormat(r,a);return i.map((e=>{const t=d?1-n.scale(e):n.scale(e);return{tick:c(e),position:n.gridLine(t),angle:n.tickAngle,size:n.tickSize,textAnchor:n.tickTextAnchor}}))}))},m.tickAngles=function(e){return e?(L.tickAngle=e[0],S.tickAngle=e[1],v.tickAngle=e[2],m):[L.tickAngle,S.tickAngle,v.tickAngle]},m.tickSizes=function(e){return e?Array.isArray(e)?(L.tickSize=e[0],S.tickSize=e[1],v.tickSize=e[2],m):(L.tickSize=S.tickSize=v.tickSize=+e,m):[L.tickSize,S.tickSize,v.tickSize]},m.tickFormat=function(e){return e?(a=e,m):a},m.tickTextAnchors=function(e){return e?(L.tickTextAnchor=e[0],S.tickTextAnchor=e[1],v.tickTextAnchor=e[2],m):[L.tickTextAnchor,S.tickTextAnchor,v.tickTextAnchor]},m.labels=function(e){return e?(L.label=String(e[0]),S.label=String(e[1]),v.label=String(e[2]),m):[L.label,S.label,v.label]},m.labelAngles=function(e){return e?(L.labelAngle=e[0],S.labelAngle=e[1],v.labelAngle=e[2],m):[L.labelAngle,S.labelAngle,v.labelAngle]},m.labelOffsets=function(e){return e?(L.labelOffset=e[0],S.labelOffset=e[1],v.labelOffset=e[2],m):[L.labelOffset,S.labelOffset,v.labelOffset]},m.triangle=function(){return`M${A}L${h}L${p}Z`},m.radius=function(e){return e?(t=+e,[A,h,p]=m.vertices(),L.gridLine=s(p,A),S.gridLine=s(A,h),v.gridLine=s(h,p),m):t},m.scale=function(e){return e?(r=+e,m.transform(),m):r},m.translate=function(e){return e?(i=e[0],c=e[1],m.transform(),m):[i,c]},m.invert=function(n){const r=[n[0]/t,n[1]/t];return e.invert(r)},m.transform=function(){if(1===r)return i=0,c=0,m;const[n,t,a]=b,[l,s,f]=b.map((([e,n])=>[e*r+i,n*r+c])),k=u(n,t),A=u(n,a),h=u(t,a),p=l[1]-k*l[0],L=l[1]-A*l[0],S=s[1]-h*s[0],v=g(n[1],L,A),y=g(d?t[1]:n[1],p,k),x=g(t[1],S,h);if(y<-1e-4){const[e,n]=o(k,y);i+=e,c+=n}if(v<-1e-4){const[e,n]=o(A,v);i+=e,c+=n}if(x<-1e-4){const[e,n]=o(h,x);i+=e,c+=n}const[z,O,M]=b,T=([e,n])=>[e*r+i,n*r+c],j=[T(z),T(O),T(M)];return e.vertices(j),m},m.transformFromDomains=function(e){const[n,t,r]=e,i=[...l(e)][0],[c,a,o]=b,s=1/i,u=(e=>(e-1)/(3*e))(s),f=u-n[0],g=u-t[0],d=u-r[0],[m,k]=[c[0]*f+a[0]*g+o[0]*d,c[1]*f+a[1]*g+o[1]*d].map((e=>e*s));return{k:s,x:m,y:k}},m.domainsFromVertices=function(){const[n,t,r]=b.map(e.invert);return[[t[0],n[0]].map(f),[r[1],t[1]].map(f),[n[2],r[2]].map(f)]},m},Object.defineProperty(e,"__esModule",{value:!0})}));
