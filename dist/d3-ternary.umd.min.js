// https://github.com/davenquinn/d3-ternary#readme v2.0.3 Copyright 2021 Jules Blom
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-scale"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-array"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).d3=e.d3||{},e.d3,e.d3)}(this,(function(e,n,t){"use strict";const{cos:r,sin:i,atan:c,sign:a}=Math,l=e=>new Set(e.map((e=>{const n=Math.round(100*(e[0]+Number.EPSILON))/100,t=Math.round(100*(e[1]+Number.EPSILON))/100;return Math.abs(t-n)}))),o=(e,n)=>{if(0===e)return[0,-n];return b(-1/e,n)};function s([e,n],[t,r]){return function(i){return[e+i*(t-e),n+i*(r-n)]}}const u=([e,n],[t,r])=>(r-n)/(t-e),f=e=>e>.999999?1:e<1e-6?0:e,g=(e,n,t)=>(n-e)*Math.sign(e)/Math.sqrt(Math.pow(t,2)+1),b=(e,n)=>{const t=c(e);return[n*r(t)*a(t),n*i(t)*a(t)]};e.barycentric=function(){const{sin:e,cos:n,PI:r}=Math,i=r/180;let c=e=>e[0],a=e=>e[1],l=e=>e[2],[o,s,u]=[-90,150,30].map((t=>[n(t*i),e(t*i)]));function f(e){const n=[c(e),a(e),l(e)],r=t.sum(n);return 0===r?[0,0,0]:n.map((e=>e/r))}const g=function(e){const[n,t,r]=f(e);return[o[0]*n+s[0]*t+u[0]*r,o[1]*n+s[1]*t+u[1]*r]};return g.invert=function([e,n]){const[t,r]=o,[i,c]=s,[a,l]=u,f=c-l,g=a-i,b=t-a,d=l-r,m=e-a,k=n-l,A=f*b+g*(r-l),h=Math.abs((f*m+g*k)/A),p=Math.abs((d*m+b*k)/A);return[h,p,Math.abs(1-h-p)]},g.a=function(e){return e?(c=e,g):c},g.b=function(e){return e?(a=e,g):a},g.c=function(e){return e?(l=e,g):l},g.normalize=f,g.vertices=function(e){return e?(o=e[0],s=e[1],u=e[2],g):[o,s,u]},g},e.ternaryPlot=function(e){let t=300,r=1,i=0,c=0,a="%",b=!1,d=e.vertices();function m(n){const[r,i]=e(n);return[r*t,i*t]}function k(n){if(n){const r=n.map((([e,n])=>[e/t,n/t]));return e.vertices(r),m}return e.vertices().map((([e,n])=>[e*t,n*t]))}let[A,h,p]=k(),L={label:"A",labelAngle:0,labelOffset:45,gridLine:s(p,A),scale:n.scaleLinear().domain([0,1]),tickAngle:0,tickSize:6,tickTextAnchor:"start",conjugate:null},y={label:"B",labelAngle:60,labelOffset:45,gridLine:s(A,h),scale:n.scaleLinear().domain([0,1]),tickAngle:60,tickSize:6,tickTextAnchor:"end",conjugate:null},S={label:"C",labelAngle:-60,labelOffset:45,gridLine:s(h,p),scale:n.scaleLinear().domain([0,1]),tickAngle:-60,tickSize:6,tickTextAnchor:"end",conjugate:null};return L.conjugate=y,y.conjugate=S,S.conjugate=L,m.vertices=k,m.axisLabels=function({center:e=!1}={}){return[L,y,S].map((n=>{const{label:r,labelAngle:i}=n,[c,a]=n.gridLine(e?.5:1);return{position:[c/t*(t+n.labelOffset),a/t*(t+n.labelOffset)],label:r,angle:i}}))},m.setDomains=function(e){const[n,t,r]=e;return L.scale.domain(n),y.scale.domain(t),S.scale.domain(r),m},m.reverseVertices=function(){b=!0;const e=[p,A,h],[n,t,r]=d;return d=[r,n,t],m.vertices(e),L.gridLine=s(A,p),y.gridLine=s(h,A),S.gridLine=s(p,h),m},m.domains=function(e){if(!e)return[L.scale.domain(),y.scale.domain(),S.scale.domain()];if(1!==l(e).size)throw new Error("Domains must all be of equal length");e.every((e=>e[0]>e[1]))?m.reverseVertices():b=!1,m.setDomains(e);const{x:n,y:t,k:r}=m.transformFromDomains(e);return m.translate([n,t]),m.scale(r),m},m.gridLines=function(e=20){return[L,y,S].map(((n,t)=>{const r=Array.isArray(e)?+e[t]:+e;return n.scale.ticks(r-1).map((e=>{var t;return[n.gridLine(n.scale(e)),null===(t=n.conjugate)||void 0===t?void 0:t.gridLine(1-n.scale(e))]}))}))},m.ticks=function(e=10){return[L,y,S].map(((n,t)=>{const r=Array.isArray(e)?+e[t]:+e,i=n.scale.ticks(r),c="function"==typeof a?a:n.scale.tickFormat(r,a);return i.map((e=>{const t=b?1-n.scale(e):n.scale(e);return{tick:c(e),position:n.gridLine(t),angle:n.tickAngle,size:n.tickSize,textAnchor:n.tickTextAnchor}}))}))},m.tickAngles=function(e){return e?(L.tickAngle=e[0],y.tickAngle=e[1],S.tickAngle=e[2],m):[L.tickAngle,y.tickAngle,S.tickAngle]},m.tickSizes=function(e){return e?Array.isArray(e)?(L.tickSize=e[0],y.tickSize=e[1],S.tickSize=e[2],m):(L.tickSize=y.tickSize=S.tickSize=+e,m):[L.tickSize,y.tickSize,S.tickSize]},m.tickFormat=function(e){return e?(a=e,m):a},m.tickTextAnchors=function(e){return e?(L.tickTextAnchor=e[0],y.tickTextAnchor=e[1],S.tickTextAnchor=e[2],m):[L.tickTextAnchor,y.tickTextAnchor,S.tickTextAnchor]},m.labels=function(e){return e?(L.label=String(e[0]),y.label=String(e[1]),S.label=String(e[2]),m):[L.label,y.label,S.label]},m.labelAngles=function(e){return e?(L.labelAngle=e[0],y.labelAngle=e[1],S.labelAngle=e[2],m):[L.labelAngle,y.labelAngle,S.labelAngle]},m.labelOffsets=function(e){return e?Array.isArray(e)?(L.labelOffset=e[0],y.labelOffset=e[1],S.labelOffset=e[2],m):(L.labelOffset=y.labelOffset=S.labelOffset=+e,m):[L.labelOffset,y.labelOffset,S.labelOffset]},m.triangle=function(){return`M${A}L${h}L${p}Z`},m.radius=function(e){return e?(t=+e,[A,h,p]=m.vertices(),L.gridLine=s(p,A),y.gridLine=s(A,h),S.gridLine=s(h,p),m):t},m.scale=function(e){return e?(r=+e,m.transform(),m):r},m.translate=function(e){return e?(i=e[0],c=e[1],m.transform(),m):[i,c]},m.invert=function(n){const r=[n[0]/t,n[1]/t];return e.invert(r)},m.transform=function(){if(1===r)return i=0,c=0,m;const[n,t,a]=d,[l,s,f]=d.map((([e,n])=>[e*r+i,n*r+c])),k=u(n,t),A=u(n,a),h=u(t,a),p=l[1]-k*l[0],L=l[1]-A*l[0],y=s[1]-h*s[0],S=g(n[1],L,A),v=g(b?t[1]:n[1],p,k),x=g(t[1],y,h);if(v<-1e-4){const[e,n]=o(k,v);i+=e,c+=n}if(S<-1e-4){const[e,n]=o(A,S);i+=e,c+=n}if(x<-1e-4){const[e,n]=o(h,x);i+=e,c+=n}const[O,z,M]=d,T=([e,n])=>[e*r+i,n*r+c],j=[T(O),T(z),T(M)];return e.vertices(j),m},m.transformFromDomains=function(e){const[n,t,r]=e,i=[...l(e)][0],[c,a,o]=d,s=1/i,u=(e=>(e-1)/(3*e))(s),f=u-n[0],g=u-t[0],b=u-r[0],[m,k]=[c[0]*f+a[0]*g+o[0]*b,c[1]*f+a[1]*g+o[1]*b].map((e=>e*s));return{k:s,x:m,y:k}},m.domainsFromVertices=function(){const[n,t,r]=d.map(e.invert);return[[t[0],n[0]].map(f),[r[1],t[1]].map(f),[n[2],r[2]].map(f)]},m},Object.defineProperty(e,"__esModule",{value:!0})}));
