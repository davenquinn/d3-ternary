// https://github.com/davenquinn/d3-ternary#readme v2.0.3 Copyright 2021 Jules Blom
function n(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function t(t){let e=t,r=t;function i(n,t,e,i){for(null==e&&(e=0),null==i&&(i=n.length);e<i;){const a=e+i>>>1;r(n[a],t)<0?e=a+1:i=a}return e}return 1===t.length&&(e=(n,e)=>t(n)-e,r=function(t){return(e,r)=>n(t(e),r)}(t)),{left:i,center:function(n,t,r,a){null==r&&(r=0),null==a&&(a=n.length);const o=i(n,t,r,a-1);return o>r&&e(n[o-1],t)>-e(n[o],t)?o-1:o},right:function(n,t,e,i){for(null==e&&(e=0),null==i&&(i=n.length);e<i;){const a=e+i>>>1;r(n[a],t)>0?i=a:e=a+1}return e}}}const e=t(n).right;t((function(n){return null===n?NaN:+n})).center;var r=Math.sqrt(50),i=Math.sqrt(10),a=Math.sqrt(2);function o(n,t,e){var o=(t-n)/Math.max(0,e),u=Math.floor(Math.log(o)/Math.LN10),l=o/Math.pow(10,u);return u>=0?(l>=r?10:l>=i?5:l>=a?2:1)*Math.pow(10,u):-Math.pow(10,-u)/(l>=r?10:l>=i?5:l>=a?2:1)}function u(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n)}return this}function l(n,t,e){n.prototype=t.prototype=e,e.constructor=n}function c(n,t){var e=Object.create(n.prototype);for(var r in t)e[r]=t[r];return e}function s(){}var h=1/.7,f="\\s*([+-]?\\d+)\\s*",g="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",m="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",d=/^#([0-9a-f]{3,8})$/,p=new RegExp("^rgb\\("+[f,f,f]+"\\)$"),b=new RegExp("^rgb\\("+[m,m,m]+"\\)$"),y=new RegExp("^rgba\\("+[f,f,f,g]+"\\)$"),v=new RegExp("^rgba\\("+[m,m,m,g]+"\\)$"),M=new RegExp("^hsl\\("+[g,m,m]+"\\)$"),w=new RegExp("^hsla\\("+[g,m,m,g]+"\\)$"),k={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function x(){return this.rgb().formatHex()}function A(){return this.rgb().formatRgb()}function N(n){var t,e;return n=(n+"").trim().toLowerCase(),(t=d.exec(n))?(e=t[1].length,t=parseInt(t[1],16),6===e?S(t):3===e?new j(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===e?z(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===e?z(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=p.exec(n))?new j(t[1],t[2],t[3],1):(t=b.exec(n))?new j(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=y.exec(n))?z(t[1],t[2],t[3],t[4]):(t=v.exec(n))?z(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=M.exec(n))?T(t[1],t[2]/100,t[3]/100,1):(t=w.exec(n))?T(t[1],t[2]/100,t[3]/100,t[4]):k.hasOwnProperty(n)?S(k[n]):"transparent"===n?new j(NaN,NaN,NaN,0):null}function S(n){return new j(n>>16&255,n>>8&255,255&n,1)}function z(n,t,e,r){return r<=0&&(n=t=e=NaN),new j(n,t,e,r)}function L(n){return n instanceof s||(n=N(n)),n?new j((n=n.rgb()).r,n.g,n.b,n.opacity):new j}function O(n,t,e,r){return 1===arguments.length?L(n):new j(n,t,e,null==r?1:r)}function j(n,t,e,r){this.r=+n,this.g=+t,this.b=+e,this.opacity=+r}function E(){return"#"+q(this.r)+q(this.g)+q(this.b)}function $(){var n=this.opacity;return(1===(n=isNaN(n)?1:Math.max(0,Math.min(1,n)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===n?")":", "+n+")")}function q(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function T(n,t,e,r){return r<=0?n=t=e=NaN:e<=0||e>=1?n=t=NaN:t<=0&&(n=NaN),new F(n,t,e,r)}function R(n){if(n instanceof F)return new F(n.h,n.s,n.l,n.opacity);if(n instanceof s||(n=N(n)),!n)return new F;if(n instanceof F)return n;var t=(n=n.rgb()).r/255,e=n.g/255,r=n.b/255,i=Math.min(t,e,r),a=Math.max(t,e,r),o=NaN,u=a-i,l=(a+i)/2;return u?(o=t===a?(e-r)/u+6*(e<r):e===a?(r-t)/u+2:(t-e)/u+4,u/=l<.5?a+i:2-a-i,o*=60):u=l>0&&l<1?0:o,new F(o,u,l,n.opacity)}function F(n,t,e,r){this.h=+n,this.s=+t,this.l=+e,this.opacity=+r}function D(n,t,e){return 255*(n<60?t+(e-t)*n/60:n<180?e:n<240?t+(e-t)*(240-n)/60:t)}l(s,N,{copy:function(n){return Object.assign(new this.constructor,this,n)},displayable:function(){return this.rgb().displayable()},hex:x,formatHex:x,formatHsl:function(){return R(this).formatHsl()},formatRgb:A,toString:A}),l(j,O,c(s,{brighter:function(n){return n=null==n?h:Math.pow(h,n),new j(this.r*n,this.g*n,this.b*n,this.opacity)},darker:function(n){return n=null==n?.7:Math.pow(.7,n),new j(this.r*n,this.g*n,this.b*n,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:E,formatHex:E,formatRgb:$,toString:$})),l(F,(function(n,t,e,r){return 1===arguments.length?R(n):new F(n,t,e,null==r?1:r)}),c(s,{brighter:function(n){return n=null==n?h:Math.pow(h,n),new F(this.h,this.s,this.l*n,this.opacity)},darker:function(n){return n=null==n?.7:Math.pow(.7,n),new F(this.h,this.s,this.l*n,this.opacity)},rgb:function(){var n=this.h%360+360*(this.h<0),t=isNaN(n)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*t,i=2*e-r;return new j(D(n>=240?n-240:n+120,i,r),D(n,i,r),D(n<120?n+240:n-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var n=this.opacity;return(1===(n=isNaN(n)?1:Math.max(0,Math.min(1,n)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===n?")":", "+n+")")}}));var P=n=>()=>n;function I(n){return 1==(n=+n)?H:function(t,e){return e-t?function(n,t,e){return n=Math.pow(n,e),t=Math.pow(t,e)-n,e=1/e,function(r){return Math.pow(n+r*t,e)}}(t,e,n):P(isNaN(t)?e:t)}}function H(n,t){var e=t-n;return e?function(n,t){return function(e){return n+e*t}}(n,e):P(isNaN(n)?t:n)}var C=function n(t){var e=I(t);function r(n,t){var r=e((n=O(n)).r,(t=O(t)).r),i=e(n.g,t.g),a=e(n.b,t.b),o=H(n.opacity,t.opacity);return function(t){return n.r=r(t),n.g=i(t),n.b=a(t),n.opacity=o(t),n+""}}return r.gamma=n,r}(1);function V(n,t){t||(t=[]);var e,r=n?Math.min(t.length,n.length):0,i=t.slice();return function(a){for(e=0;e<r;++e)i[e]=n[e]*(1-a)+t[e]*a;return i}}function B(n,t){var e,r=t?t.length:0,i=n?Math.min(r,n.length):0,a=new Array(i),o=new Array(r);for(e=0;e<i;++e)a[e]=K(n[e],t[e]);for(;e<r;++e)o[e]=t[e];return function(n){for(e=0;e<i;++e)o[e]=a[e](n);return o}}function X(n,t){var e=new Date;return n=+n,t=+t,function(r){return e.setTime(n*(1-r)+t*r),e}}function Z(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function G(n,t){var e,r={},i={};for(e in null!==n&&"object"==typeof n||(n={}),null!==t&&"object"==typeof t||(t={}),t)e in n?r[e]=K(n[e],t[e]):i[e]=t[e];return function(n){for(e in r)i[e]=r[e](n);return i}}var U=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Y=new RegExp(U.source,"g");function J(n,t){var e,r,i,a=U.lastIndex=Y.lastIndex=0,o=-1,u=[],l=[];for(n+="",t+="";(e=U.exec(n))&&(r=Y.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),u[o]?u[o]+=i:u[++o]=i),(e=e[0])===(r=r[0])?u[o]?u[o]+=r:u[++o]=r:(u[++o]=null,l.push({i:o,x:Z(e,r)})),a=Y.lastIndex;return a<t.length&&(i=t.slice(a),u[o]?u[o]+=i:u[++o]=i),u.length<2?l[0]?function(n){return function(t){return n(t)+""}}(l[0].x):function(n){return function(){return n}}(t):(t=l.length,function(n){for(var e,r=0;r<t;++r)u[(e=l[r]).i]=e.x(n);return u.join("")})}function K(n,t){var e,r,i=typeof t;return null==t||"boolean"===i?P(t):("number"===i?Z:"string"===i?(e=N(t))?(t=e,C):J:t instanceof N?C:t instanceof Date?X:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?B:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?G:Z:V))(n,t)}function Q(n,t){return n=+n,t=+t,function(e){return Math.round(n*(1-e)+t*e)}}function W(n){return+n}var _=[0,1];function nn(n){return n}function tn(n,t){return(t-=n=+n)?function(e){return(e-n)/t}:(e=isNaN(t)?NaN:.5,function(){return e});var e}function en(n,t,e){var r=n[0],i=n[1],a=t[0],o=t[1];return i<r?(r=tn(i,r),a=e(o,a)):(r=tn(r,i),a=e(a,o)),function(n){return a(r(n))}}function rn(n,t,r){var i=Math.min(n.length,t.length)-1,a=new Array(i),o=new Array(i),u=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++u<i;)a[u]=tn(n[u],n[u+1]),o[u]=r(t[u],t[u+1]);return function(t){var r=e(n,t,1,i)-1;return o[r](a[r](t))}}function an(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function on(){var n,t,e,r,i,a,o=_,u=_,l=K,c=nn;function s(){var n,t,e,l=Math.min(o.length,u.length);return c!==nn&&(n=o[0],t=o[l-1],n>t&&(e=n,n=t,t=e),c=function(e){return Math.max(n,Math.min(t,e))}),r=l>2?rn:en,i=a=null,h}function h(t){return null==t||isNaN(t=+t)?e:(i||(i=r(o.map(n),u,l)))(n(c(t)))}return h.invert=function(e){return c(t((a||(a=r(u,o.map(n),Z)))(e)))},h.domain=function(n){return arguments.length?(o=Array.from(n,W),s()):o.slice()},h.range=function(n){return arguments.length?(u=Array.from(n),s()):u.slice()},h.rangeRound=function(n){return u=Array.from(n),l=Q,s()},h.clamp=function(n){return arguments.length?(c=!!n||nn,s()):c!==nn},h.interpolate=function(n){return arguments.length?(l=n,s()):l},h.unknown=function(n){return arguments.length?(e=n,h):e},function(e,r){return n=e,t=r,s()}}function un(){return on()(nn,nn)}function ln(n,t){if((e=(n=t?n.toExponential(t-1):n.toExponential()).indexOf("e"))<0)return null;var e,r=n.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+n.slice(e+1)]}function cn(n){return(n=ln(Math.abs(n)))?n[1]:NaN}var sn,hn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function fn(n){if(!(t=hn.exec(n)))throw new Error("invalid format: "+n);var t;return new gn({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function gn(n){this.fill=void 0===n.fill?" ":n.fill+"",this.align=void 0===n.align?">":n.align+"",this.sign=void 0===n.sign?"-":n.sign+"",this.symbol=void 0===n.symbol?"":n.symbol+"",this.zero=!!n.zero,this.width=void 0===n.width?void 0:+n.width,this.comma=!!n.comma,this.precision=void 0===n.precision?void 0:+n.precision,this.trim=!!n.trim,this.type=void 0===n.type?"":n.type+""}function mn(n,t){var e=ln(n,t);if(!e)return n+"";var r=e[0],i=e[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}fn.prototype=gn.prototype,gn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var dn={"%":(n,t)=>(100*n).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:function(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)},e:(n,t)=>n.toExponential(t),f:(n,t)=>n.toFixed(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>mn(100*n,t),r:mn,s:function(n,t){var e=ln(n,t);if(!e)return n+"";var r=e[0],i=e[1],a=i-(sn=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+ln(n,Math.max(0,t+a-1))[0]},X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function pn(n){return n}var bn,yn,vn,Mn=Array.prototype.map,wn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function kn(n){var t,e,r=void 0===n.grouping||void 0===n.thousands?pn:(t=Mn.call(n.grouping,Number),e=n.thousands+"",function(n,r){for(var i=n.length,a=[],o=0,u=t[0],l=0;i>0&&u>0&&(l+u+1>r&&(u=Math.max(1,r-l)),a.push(n.substring(i-=u,i+u)),!((l+=u+1)>r));)u=t[o=(o+1)%t.length];return a.reverse().join(e)}),i=void 0===n.currency?"":n.currency[0]+"",a=void 0===n.currency?"":n.currency[1]+"",o=void 0===n.decimal?".":n.decimal+"",u=void 0===n.numerals?pn:function(n){return function(t){return t.replace(/[0-9]/g,(function(t){return n[+t]}))}}(Mn.call(n.numerals,String)),l=void 0===n.percent?"%":n.percent+"",c=void 0===n.minus?"−":n.minus+"",s=void 0===n.nan?"NaN":n.nan+"";function h(n){var t=(n=fn(n)).fill,e=n.align,h=n.sign,f=n.symbol,g=n.zero,m=n.width,d=n.comma,p=n.precision,b=n.trim,y=n.type;"n"===y?(d=!0,y="g"):dn[y]||(void 0===p&&(p=12),b=!0,y="g"),(g||"0"===t&&"="===e)&&(g=!0,t="0",e="=");var v="$"===f?i:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",M="$"===f?a:/[%p]/.test(y)?l:"",w=dn[y],k=/[defgprs%]/.test(y);function x(n){var i,a,l,f=v,x=M;if("c"===y)x=w(n)+x,n="";else{var A=(n=+n)<0||1/n<0;if(n=isNaN(n)?s:w(Math.abs(n),p),b&&(n=function(n){n:for(var t,e=n.length,r=1,i=-1;r<e;++r)switch(n[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+n[r])break n;i>0&&(i=0)}return i>0?n.slice(0,i)+n.slice(t+1):n}(n)),A&&0==+n&&"+"!==h&&(A=!1),f=(A?"("===h?h:c:"-"===h||"("===h?"":h)+f,x=("s"===y?wn[8+sn/3]:"")+x+(A&&"("===h?")":""),k)for(i=-1,a=n.length;++i<a;)if(48>(l=n.charCodeAt(i))||l>57){x=(46===l?o+n.slice(i+1):n.slice(i))+x,n=n.slice(0,i);break}}d&&!g&&(n=r(n,1/0));var N=f.length+n.length+x.length,S=N<m?new Array(m-N+1).join(t):"";switch(d&&g&&(n=r(S+n,S.length?m-x.length:1/0),S=""),e){case"<":n=f+n+x+S;break;case"=":n=f+S+n+x;break;case"^":n=S.slice(0,N=S.length>>1)+f+n+x+S.slice(N);break;default:n=S+f+n+x}return u(n)}return p=void 0===p?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,p)):Math.max(0,Math.min(20,p)),x.toString=function(){return n+""},x}return{format:h,formatPrefix:function(n,t){var e=h(((n=fn(n)).type="f",n)),r=3*Math.max(-8,Math.min(8,Math.floor(cn(t)/3))),i=Math.pow(10,-r),a=wn[8+r/3];return function(n){return e(i*n)+a}}}}function xn(n,t,e,o){var u,l=function(n,t,e){var o=Math.abs(t-n)/Math.max(0,e),u=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),l=o/u;return l>=r?u*=10:l>=i?u*=5:l>=a&&(u*=2),t<n?-u:u}(n,t,e);switch((o=fn(null==o?",f":o)).type){case"s":var c=Math.max(Math.abs(n),Math.abs(t));return null!=o.precision||isNaN(u=function(n,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(cn(t)/3)))-cn(Math.abs(n)))}(l,c))||(o.precision=u),vn(o,c);case"":case"e":case"g":case"p":case"r":null!=o.precision||isNaN(u=function(n,t){return n=Math.abs(n),t=Math.abs(t)-n,Math.max(0,cn(t)-cn(n))+1}(l,Math.max(Math.abs(n),Math.abs(t))))||(o.precision=u-("e"===o.type));break;case"f":case"%":null!=o.precision||isNaN(u=function(n){return Math.max(0,-cn(Math.abs(n)))}(l))||(o.precision=u-2*("%"===o.type))}return yn(o)}function An(n){var t=n.domain;return n.ticks=function(n){var e=t();return function(n,t,e){var r,i,a,u,l=-1;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if((r=t<n)&&(i=n,n=t,t=i),0===(u=o(n,t,e))||!isFinite(u))return[];if(u>0){let e=Math.round(n/u),r=Math.round(t/u);for(e*u<n&&++e,r*u>t&&--r,a=new Array(i=r-e+1);++l<i;)a[l]=(e+l)*u}else{u=-u;let e=Math.round(n*u),r=Math.round(t*u);for(e/u<n&&++e,r/u>t&&--r,a=new Array(i=r-e+1);++l<i;)a[l]=(e+l)/u}return r&&a.reverse(),a}(e[0],e[e.length-1],null==n?10:n)},n.tickFormat=function(n,e){var r=t();return xn(r[0],r[r.length-1],null==n?10:n,e)},n.nice=function(e){null==e&&(e=10);var r,i,a=t(),u=0,l=a.length-1,c=a[u],s=a[l],h=10;for(s<c&&(i=c,c=s,s=i,i=u,u=l,l=i);h-- >0;){if((i=o(c,s,e))===r)return a[u]=c,a[l]=s,t(a);if(i>0)c=Math.floor(c/i)*i,s=Math.ceil(s/i)*i;else{if(!(i<0))break;c=Math.ceil(c*i)/i,s=Math.floor(s*i)/i}r=i}return n},n}function Nn(){var n=un();return n.copy=function(){return an(n,Nn())},u.apply(n,arguments),An(n)}bn=kn({thousands:",",grouping:[3],currency:["$",""]}),yn=bn.format,vn=bn.formatPrefix;const{cos:Sn,sin:zn,atan:Ln,sign:On}=Math,jn=n=>new Set(n.map((n=>{const t=Math.round(100*(n[0]+Number.EPSILON))/100,e=Math.round(100*(n[1]+Number.EPSILON))/100;return Math.abs(e-t)}))),En=(n,t)=>{if(0===n)return[0,-t];return Fn(-1/n,t)};function $n([n,t],[e,r]){return function(i){return[n+i*(e-n),t+i*(r-t)]}}const qn=([n,t],[e,r])=>(r-t)/(e-n),Tn=n=>n>.999999?1:n<1e-6?0:n,Rn=(n,t,e)=>(t-n)*Math.sign(n)/Math.sqrt(Math.pow(e,2)+1),Fn=(n,t)=>{const e=Ln(n);return[t*Sn(e)*On(e),t*zn(e)*On(e)]};function Dn(n){let t=300,e=1,r=0,i=0,a="%",o=!1,u=n.vertices();function l(e){const[r,i]=n(e);return[r*t,i*t]}function c(e){if(e){const r=e.map((([n,e])=>[n/t,e/t]));return n.vertices(r),l}return n.vertices().map((([n,e])=>[n*t,e*t]))}let[s,h,f]=c(),g={label:"A",labelAngle:0,labelOffset:45,gridLine:$n(f,s),scale:Nn().domain([0,1]),tickAngle:0,tickSize:6,tickTextAnchor:"start",conjugate:null},m={label:"B",labelAngle:60,labelOffset:45,gridLine:$n(s,h),scale:Nn().domain([0,1]),tickAngle:60,tickSize:6,tickTextAnchor:"end",conjugate:null},d={label:"C",labelAngle:-60,labelOffset:45,gridLine:$n(h,f),scale:Nn().domain([0,1]),tickAngle:-60,tickSize:6,tickTextAnchor:"end",conjugate:null};return g.conjugate=m,m.conjugate=d,d.conjugate=g,l.vertices=c,l.axisLabels=function({center:n=!1}={}){return[g,m,d].map((e=>{const{label:r,labelAngle:i}=e,[a,o]=e.gridLine(n?.5:1);return{position:[a/t*(t+e.labelOffset),o/t*(t+e.labelOffset)],label:r,angle:i}}))},l.setDomains=function(n){const[t,e,r]=n;return g.scale.domain(t),m.scale.domain(e),d.scale.domain(r),l},l.reverseVertices=function(){o=!0;const n=[f,s,h],[t,e,r]=u;return u=[r,t,e],l.vertices(n),g.gridLine=$n(s,f),m.gridLine=$n(h,s),d.gridLine=$n(f,h),l},l.domains=function(n){if(!n)return[g.scale.domain(),m.scale.domain(),d.scale.domain()];if(1!==jn(n).size)throw new Error("Domains must all be of equal length");n.every((n=>n[0]>n[1]))?l.reverseVertices():o=!1,l.setDomains(n);const{x:t,y:e,k:r}=l.transformFromDomains(n);return l.translate([t,e]),l.scale(r),l},l.gridLines=function(n=20){return[g,m,d].map(((t,e)=>{const r=Array.isArray(n)?+n[e]:+n;return t.scale.ticks(r-1).map((n=>{var e;return[t.gridLine(t.scale(n)),null===(e=t.conjugate)||void 0===e?void 0:e.gridLine(1-t.scale(n))]}))}))},l.ticks=function(n=10){return[g,m,d].map(((t,e)=>{const r=Array.isArray(n)?+n[e]:+n,i=t.scale.ticks(r),u="function"==typeof a?a:t.scale.tickFormat(r,a);return i.map((n=>{const e=o?1-t.scale(n):t.scale(n);return{tick:u(n),position:t.gridLine(e),angle:t.tickAngle,size:t.tickSize,textAnchor:t.tickTextAnchor}}))}))},l.tickAngles=function(n){return n?(g.tickAngle=n[0],m.tickAngle=n[1],d.tickAngle=n[2],l):[g.tickAngle,m.tickAngle,d.tickAngle]},l.tickSizes=function(n){return n?Array.isArray(n)?(g.tickSize=n[0],m.tickSize=n[1],d.tickSize=n[2],l):(g.tickSize=m.tickSize=d.tickSize=+n,l):[g.tickSize,m.tickSize,d.tickSize]},l.tickFormat=function(n){return n?(a=n,l):a},l.tickTextAnchors=function(n){return n?(g.tickTextAnchor=n[0],m.tickTextAnchor=n[1],d.tickTextAnchor=n[2],l):[g.tickTextAnchor,m.tickTextAnchor,d.tickTextAnchor]},l.labels=function(n){return n?(g.label=String(n[0]),m.label=String(n[1]),d.label=String(n[2]),l):[g.label,m.label,d.label]},l.labelAngles=function(n){return n?(g.labelAngle=n[0],m.labelAngle=n[1],d.labelAngle=n[2],l):[g.labelAngle,m.labelAngle,d.labelAngle]},l.labelOffsets=function(n){return n?Array.isArray(n)?(g.labelOffset=n[0],m.labelOffset=n[1],d.labelOffset=n[2],l):(g.labelOffset=m.labelOffset=d.labelOffset=+n,l):[g.labelOffset,m.labelOffset,d.labelOffset]},l.triangle=function(){return`M${s}L${h}L${f}Z`},l.radius=function(n){return n?(t=+n,[s,h,f]=l.vertices(),g.gridLine=$n(f,s),m.gridLine=$n(s,h),d.gridLine=$n(h,f),l):t},l.scale=function(n){return n?(e=+n,l.transform(),l):e},l.translate=function(n){return n?(r=n[0],i=n[1],l.transform(),l):[r,i]},l.invert=function(e){const r=[e[0]/t,e[1]/t];return n.invert(r)},l.transform=function(){if(1===e)return r=0,i=0,l;const[t,a,c]=u,[s,h,f]=u.map((([n,t])=>[n*e+r,t*e+i])),g=qn(t,a),m=qn(t,c),d=qn(a,c),p=s[1]-g*s[0],b=s[1]-m*s[0],y=h[1]-d*h[0],v=Rn(t[1],b,m),M=Rn(o?a[1]:t[1],p,g),w=Rn(a[1],y,d);if(M<-1e-4){const[n,t]=En(g,M);r+=n,i+=t}if(v<-1e-4){const[n,t]=En(m,v);r+=n,i+=t}if(w<-1e-4){const[n,t]=En(d,w);r+=n,i+=t}const[k,x,A]=u,N=([n,t])=>[n*e+r,t*e+i],S=[N(k),N(x),N(A)];return n.vertices(S),l},l.transformFromDomains=function(n){const[t,e,r]=n,i=[...jn(n)][0],[a,o,l]=u,c=1/i,s=(n=>(n-1)/(3*n))(c),h=s-t[0],f=s-e[0],g=s-r[0],[m,d]=[a[0]*h+o[0]*f+l[0]*g,a[1]*h+o[1]*f+l[1]*g].map((n=>n*c));return{k:c,x:m,y:d}},l.domainsFromVertices=function(){const[t,e,r]=u.map(n.invert);return[[e[0],t[0]].map(Tn),[r[1],e[1]].map(Tn),[t[2],r[2]].map(Tn)]},l}function Pn(){const{sin:n,cos:t,PI:e}=Math,r=e/180;let i=n=>n[0],a=n=>n[1],o=n=>n[2];let[u,l,c]=[-90,150,30].map((e=>[t(e*r),n(e*r)]));function s(n){const t=[i(n),a(n),o(n)],e=function(n,t){let e=0;if(void 0===t)for(let t of n)(t=+t)&&(e+=t);else{let r=-1;for(let i of n)(i=+t(i,++r,n))&&(e+=i)}return e}(t);return 0===e?[0,0,0]:t.map((n=>n/e))}const h=function(n){const[t,e,r]=s(n);return[u[0]*t+l[0]*e+c[0]*r,u[1]*t+l[1]*e+c[1]*r]};return h.invert=function([n,t]){const[e,r]=u,[i,a]=l,[o,s]=c,h=a-s,f=o-i,g=e-o,m=s-r,d=n-o,p=t-s,b=h*g+f*(r-s),y=Math.abs((h*d+f*p)/b),v=Math.abs((m*d+g*p)/b);return[y,v,Math.abs(1-y-v)]},h.a=function(n){return n?(i=n,h):i},h.b=function(n){return n?(a=n,h):a},h.c=function(n){return n?(o=n,h):o},h.normalize=s,h.vertices=function(n){return n?(u=n[0],l=n[1],c=n[2],h):[u,l,c]},h}export{Pn as barycentric,Dn as ternaryPlot};
